<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>ECS Architecture for GUI applications - Very Good Graphics Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="Harry"><meta name=description content="ECS, short for Entity-Component-System, is an architectural design pattern originally found in video game programming. It is a powerful technique that eases programming headaches as well as boosts the performance of a game containing a huge amount of interactive objects.
That&amp;rsquo;s why the VGG engine takes ECS as the fundamental architecture because VGG targets high performance in the very beginning. However, VGG is more about making interactive applications, particularly GUI applications. Would the ECS architecture still be suitable for such a task? Let&amp;rsquo;s dive a little deeper.
"><meta name=keywords content="Graphics,Design,Engine"><meta name=generator content="Hugo 0.117.0"><link rel=canonical href=https://blog.verygoodgraphics.com/posts/ecs/><link rel=icon href=../../favicon.ico><link rel=stylesheet href=../../sass/jane.min.5d7855e0590d7bffc8ae3baebc0a7d714f414ae2cf0be3427da43e7e2f8b6ee2.css integrity="sha256-XXhV4FkNe//IrjuuvAp9cU9BSuLPC+NCfaQ+fi+LbuI=" media=screen crossorigin=anonymous><meta property="og:title" content="ECS Architecture for GUI applications"><meta property="og:description" content="ECS, short for Entity-Component-System, is an architectural design pattern originally found in video game programming. It is a powerful technique that eases programming headaches as well as boosts the performance of a game containing a huge amount of interactive objects.
That&rsquo;s why the VGG engine takes ECS as the fundamental architecture because VGG targets high performance in the very beginning. However, VGG is more about making interactive applications, particularly GUI applications. Would the ECS architecture still be suitable for such a task? Let&rsquo;s dive a little deeper."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.verygoodgraphics.com/posts/ecs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-14T21:28:17+08:00"><meta property="article:modified_time" content="2023-08-11T14:15:35+08:00"><meta itemprop=name content="ECS Architecture for GUI applications"><meta itemprop=description content="ECS, short for Entity-Component-System, is an architectural design pattern originally found in video game programming. It is a powerful technique that eases programming headaches as well as boosts the performance of a game containing a huge amount of interactive objects.
That&rsquo;s why the VGG engine takes ECS as the fundamental architecture because VGG targets high performance in the very beginning. However, VGG is more about making interactive applications, particularly GUI applications. Would the ECS architecture still be suitable for such a task? Let&rsquo;s dive a little deeper."><meta itemprop=datePublished content="2022-09-14T21:28:17+08:00"><meta itemprop=dateModified content="2023-08-11T14:15:35+08:00"><meta itemprop=wordCount content="2490"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="ECS Architecture for GUI applications"><meta name=twitter:description content="ECS, short for Entity-Component-System, is an architectural design pattern originally found in video game programming. It is a powerful technique that eases programming headaches as well as boosts the performance of a game containing a huge amount of interactive objects.
That&rsquo;s why the VGG engine takes ECS as the fundamental architecture because VGG targets high performance in the very beginning. However, VGG is more about making interactive applications, particularly GUI applications. Would the ECS architecture still be suitable for such a task? Let&rsquo;s dive a little deeper."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script async src="https://www.googletagmanager.com/gtag/js?id=G-8EQ2DPY42J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8EQ2DPY42J",{anonymize_ip:!1})}</script></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=../../ class=logo>VeryGoodGraphics</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://blog.verygoodgraphics.com/posts/>All Posts</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://blog.verygoodgraphics.com/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://verygoodgraphics.com rel=noopener target=_blank>VGG Site
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav><link rel=stylesheet href=../../lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=../../lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class=header><div class=logo-wrapper><a href=../../ class=logo>VeryGoodGraphics</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://blog.verygoodgraphics.com/posts/>All Posts</a></li><li class=menu-item><a class=menu-item-link href=https://blog.verygoodgraphics.com/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=https://verygoodgraphics.com rel=noopener target=_blank>VGG Site
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav></header><div id=mobile-panel><main id=main class=main><div class=content-wrapper><div id=content class=content><article class="post bg-white post-detail"><header class=post-header><h1 class=post-title>ECS Architecture for GUI applications</h1><div class=post-meta><time datetime=2022-09-14 class=post-time>2022-09-14</time><div class=post-category><a href=https://blog.verygoodgraphics.com/categories/vgg-internals/>VGG Internals</a></div><span class=more-meta>2490 words</span>
<span class=more-meta>12 min read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Table of Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#the-essence-of-ecs>The Essence of ECS</a></li><li><a href=#the-essence-of-gui>The Essence of GUI</a></li><li><a href=#ecs-for-gui>ECS for GUI</a><ul><li><a href=#horizontal-query>Horizontal Query</a></li><li><a href=#vertical-query>Vertical Query</a></li><li><a href=#event-mechanism>Event Mechanism</a></li><li><a href=#summary-of-ecs-for-gui>Summary of ECS for GUI</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#contact-us>Contact us</a></li></ul></nav></div></div><div class=post-content><p>ECS, short for Entity-Component-System, is an architectural design pattern originally found in video game programming. It is a powerful technique that eases programming headaches as well as boosts the performance of a game containing a huge amount of interactive objects.</p><p>That&rsquo;s why the VGG engine takes ECS as the fundamental architecture because VGG targets high performance in the very beginning. However, VGG is more about making interactive applications, particularly GUI applications. <a name=initial-problem></a><strong>Would the ECS architecture still be suitable for such a task?</strong> Let&rsquo;s dive a little deeper.</p><h2 id=the-essence-of-ecs>The Essence of ECS</h2><p>Let&rsquo;s first talk about ECS. There are already many descriptions of ECS around the internet so we just skip the rigorous but give a one-sentence definition.</p><blockquote><p>ECS is about entities<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <em>composed</em> of different types of component whose data are manipulated by one or more systems.</p></blockquote><p>And the essence of ECS is <em>composition</em>, with obvious advantages over the <em>inheritance</em> in Object-Oriented-Programming.</p><p>In OOP, inheritance is one of three principles, the other two being <em>encapsulation</em> and <em>polymorphism</em>. Inheritance is regarded as a technique for reusing data and functions, for example, as mountain bike is a kind of bike, the <code>MountainBike</code> class shall inherit all the data of the <code>Bike</code> class as follows</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Bike</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Vehicle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Frame</span>  <span class=n>frame</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Brake</span>  <span class=n>brake</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Saddle</span> <span class=n>saddle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Wheel</span>  <span class=n>wheels</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MountainBike</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Bike</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Gear</span> <span class=n>frontGear</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Gear</span> <span class=n>rearGear</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>And when an instance is created out of <code>MountainBike</code> type, this instance will have all the data in <code>Bike</code> type plus all that of its ancestors. In this way, the data together with member functions can be reused in derived types or instances.</p><p>However, this leads to many headaches, just to name a few</p><ul><li><strong>Overhead of virtual functions</strong>: extra runtime cost of virtual table and virtual pointers, let alone some unexpected overriding pitfalls</li><li><strong>The diamond problem in multiple inheritances</strong>: ambiguous overridden data and functions from multiple ancestors</li><li><strong>Dynamic type castings</strong>: performance bottleneck of <code>dynamic_cast</code> for casting base pointer to derived pointer</li><li><strong>Complex inheritance chains</strong>: in order to model for real-world problems, complex inheritance relationships has to be designed which would look daunting for newcomers</li></ul><p>And the developer needs to know the <a href=https://www.oreilly.com/library/view/inside-the-c/0201834545/>Object-Model</a> well to write memory-safe and performant C++ code, and sometimes he needs to resort to exotic programming idoms such as CRTP<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> or SFINAE<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> for even better performance.</p><p>The complexity disappears when we use composition with ECS architecture. If we want to create a new class for <code>MountainBike</code>, we needn&rsquo;t inherit from <code>Bike</code>, but only need to describe the unique data fields a mountain bike will have. When we need an entity for a mountain bike, we could push both instances of <code>BikeComponent</code> and <code>MountainBikeComponent</code> into the entity, which are renamed from <code>Bike</code> and <code>MountainBike</code> respectively without an inheritance relationship.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>make_entity</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>BikeComponent</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>frame</span> <span class=o>=</span> <span class=n>Frame</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>brake</span> <span class=o>=</span> <span class=n>Brake</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>saddle</span> <span class=o>=</span> <span class=n>Saddle</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>wheels</span> <span class=o>=</span> <span class=p>{</span> <span class=n>Wheel</span><span class=p>{},</span> <span class=n>Wheel</span><span class=p>{}</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>MountainBikeComponent</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>frontGear</span> <span class=o>=</span> <span class=n>Gear</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>rearGear</span> <span class=o>=</span> <span class=n>Gear</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>And even more components can be pushed into an entity, each of them describing a specific feature that could be freely added to or removed from an entity. As long as proper memory layout is configured for those components for the sake of cache miss ratio reduction, the performance can be quite good.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><p>As to systems, which can be as simple as a function, would manipulate those data accordingly. It is exactly what Niklaus Wirth proposed,</p><blockquote><p>Programs = Data Structures + Algorithm</p></blockquote><p>where components represent data structures and systems represents algorithm. The programming suddenly becomes easier and clearer since no more traps are hiding behind various advanced concepts, to be more specific, no more extra runtime cost due to how the compiler implements inheritance, and no more ambiguity issues due to multiple inheritances.</p><p>As a matter of fact, ECS is a bit like <a href=https://en.wikipedia.org/wiki/Trait_(computer_programming)>Trait</a>, since a trait contains a set of functions, and both of them emphasize the concept of composition. However, a trait class cannot have member data, whereas a component could be more than a POD<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> type. All in all, ECS is an architectural design pattern, having no hard constraints on programming, so</p><ul><li>A component type is free to have inheritance relationships with another component type;</li><li>A component type is also free to have both data and member functions<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>.</li></ul><h2 id=the-essence-of-gui>The Essence of GUI</h2><p>We already have a rough impression of ECS, and now it&rsquo;s time for discussing GUI. But let&rsquo;s start with a game. A game may consist of many entities, including rivers, mountains, players, NPCs, monsters, etc. These entities usually have no relationships, or more specifically, no hierarchical relationships. In contrast, a GUI is essentially a tree of entities, where hierarchy must be imposed.</p><link rel=stylesheet href=../../css/hugo-easy-gallery.css><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject style=max-width:50%><div class=img><img itemprop=thumbnail src=../../images/simple-dialog.png></div><a href=../../images/simple-dialog.png itemprop=contentUrl></a></figure></div><p>As you can see, the simple dialog above can be divided into three parts: title, content, and the button group. The button group contains another two buttons. So the tree looks like this</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Dialog
</span></span><span class=line><span class=cl>├── Title
</span></span><span class=line><span class=cl>├── Content
</span></span><span class=line><span class=cl>└── Button Group
</span></span><span class=line><span class=cl>    ├── Cancel Button
</span></span><span class=line><span class=cl>    └── OK Button
</span></span></code></pre></td></tr></table></div></div><p>where the title and content are instances of text widget<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>, button group is of layout widget, and buttons are of the button widget. If we see each widget as an entity, these widgets comprise a hierarchical entity tree.</p><p>So the <a href=#initial-problem>initial problem</a> becomes, would the ECS architecture be suitable for modeling such a hierarchical system?</p><p>And from another aspect of view, would it be an overkill to use ECS architecture for GUI applications? Since ECS architecture could process up to millions of entities, do we really need to process such a magnitude of entities in even the most complex GUI like the following example?</p><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject style=max-width:100%><div class=img><img itemprop=thumbnail src=../../images/maya.png></div><a href=../../images/maya.png itemprop=contentUrl></a></figure></div><p>We&rsquo;ll figure out the answers in the next chapter.</p><h2 id=ecs-for-gui>ECS for GUI</h2><p>As we have mentioned in the first chapter, the data are defined by the components and the systems will update the data constantly during the whole execution lifetime. This led to an interesting question, how does the system find the appropriate data? The answer is through, in our definition, queries.</p><p>Different ECS libraries have a huge discrepancy concerning the implementation details, like how the components are organized in memory and so as with the query implementation. But this won&rsquo;t stop us from dividing the queries into two different semantic types, horizontal query, and vertical query.</p><h3 id=horizontal-query>Horizontal Query</h3><p>Let&rsquo;s have a look at the adapted code snippets from the most famous C++ ECS framework <a href=https://github.com/skypjack/entt><code>EnTT</code></a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>update</span><span class=p>(</span><span class=n>entt</span><span class=o>::</span><span class=n>registry</span> <span class=o>&amp;</span><span class=n>registry</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>view</span> <span class=o>=</span> <span class=n>registry</span><span class=p>.</span><span class=n>view</span><span class=o>&lt;</span><span class=n>position</span><span class=p>,</span> <span class=k>const</span> <span class=n>velocity</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// use a callback
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>view</span><span class=p>.</span><span class=n>each</span><span class=p>([](</span><span class=k>auto</span> <span class=o>&amp;</span><span class=n>pos</span><span class=p>,</span> <span class=k>const</span> <span class=k>auto</span> <span class=o>&amp;</span><span class=n>vel</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// use a range-for
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=k>auto</span> <span class=p>[</span><span class=n>entity</span><span class=p>,</span> <span class=n>pos</span><span class=p>,</span> <span class=n>vel</span><span class=p>]</span><span class=o>:</span> <span class=n>view</span><span class=p>.</span><span class=n>each</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// use forward iterators and get only the components of interest
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=k>auto</span> <span class=nl>entity</span><span class=p>:</span> <span class=n>view</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=k>auto</span> <span class=o>&amp;</span><span class=n>vel</span> <span class=o>=</span> <span class=n>view</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=n>velocity</span><span class=o>&gt;</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In the above code, the <code>update</code> is a simple system, which the developer could utilize to update the entity position based on its current velocity. The system at first queries all entities that have both components of <code>position</code> and <code>velocity</code>, saves the result in a view, and then iterates over each entity for updating.</p><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject style=max-width:100%><div class=img><img itemprop=thumbnail src=../../images/ecs-query.png></div><a href=../../images/ecs-query.png itemprop=contentUrl></a></figure></div><p>If we visualize this process, we will find out that the query is <strong>horizontal</strong>. It doesn&rsquo;t matter whether there is a hierarchy or not because of possibly flattened storage and indirection of the relationship.</p><p>Horizontal queries are common in video game programming, but also exist in GUI applications. Let&rsquo;s have a look at the following example.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;entity-a&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;entity&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;position-component&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;velocity-component&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;entity-b&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;entity&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;position-component&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;velocity-component&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>If we use CSS selector <code>.position-component</code>, we will get an array of <code>div</code>s whose class is <code>position-component</code>. The embedded hierarchy won&rsquo;t affect the final result.</p><p>Say, if we want to mimic the CSS selector behavior during GUI programming, we can just take advantage of the horizontal query ability of ECS, which means ECS at least suits this particular use case.</p><h3 id=vertical-query>Vertical Query</h3><p>Compared to horizontal query, vertical query focus on querying <em>entities</em>, rather than <em>components</em>. So vertical query cares about a specific <em>named</em> entity, looking into the internals and finding all the components of it.</p><p>Let&rsquo;s still take the dialog example for discussion. In order to start iterating through the entity tree, we need to find the root entity, namely the <code>dialog entity</code> in this example. After that, we search for what components this entity has, or which children it holds, then possibly recurring into each of the children for further investigations.</p><p>Here comes an interesting question. How do we model the hierarchy relationship between entities?</p><p>There are mainly two methods,</p><ul><li>We could hardcode the relationship into the entity data structure; or</li><li>We could implement a relationship component that is hot-pluggable into an entity.</li></ul><p>Each of the two methods works, but most mature ECS libraries, including <a href=https://skypjack.github.io/2019-06-25-ecs-baf-part-4/>EnTT</a> and <a href=https://ajmmertens.medium.com/building-games-in-ecs-with-entity-relationships-657275ba2c6c>flecs</a>, prefer the latter, and so does the VGG engine.</p><p>The most important advantage is the dynamic ability to add or remove a relationship, compared to the hardcoded method. Because sometimes we need more than one tree hierarchy during the whole lifetime. Take the chromium engine for <a href=https://developer.chrome.com/articles/renderingng-architecture/#architecture-components>instance</a>, during the rasterization pipeline, we need at least three trees, including the DOM tree, layout tree, and property tree, which could be peeked in the following figure from their official blog.</p><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject style=max-width:80%><div class=img><img itemprop=thumbnail src=../../images/chrome-pipeline.avif></div><a href=../../images/chrome-pipeline.avif itemprop=contentUrl></a></figure></div><p>A single node entity could be reused across multiple trees, as long as multiple relationship component is added to the entity, which is exactly what ECS excels at.</p><h3 id=event-mechanism>Event Mechanism</h3><p>In <em>interactive</em> GUI applications, how the architecture handles interactions is quite important, which is what we call the event mechanism. The <em>signal</em> concept, taken equally as the <em>event</em> concept, would be just called event in our context.</p><p>Strictly speaking, the event mechanism should not be part of ECS architecture, but as it plays an important role in interactive apps and games so good support of it is common in ECS frameworks. For example, the EnTT library proposed <a href=https://skypjack.github.io/entt/md_docs_md_signal.html>four distinct concepts</a> for the entire event mechanism, namely the delegate, the signal, the dispatcher, and the emitter.</p><p>We won&rsquo;t bother with those abstract concepts but just describe what we expected in such a framework</p><ul><li>The ability to define various types of events, including<ul><li>The inner events, which are system-generated events like the creation and destruction of an entity, as well as the addition and the deletion of a component from an entity</li><li>The outer events, which are user-generated events like mice and keyboards events, plus user-defined events which could be freely sent from one entity to another</li></ul></li><li>The ability to send events to multiple entities, like broadcasting or multicasting messages in a network, and possibly across different threads or processes.</li><li>The ability to respond to those events, using pre-registered callbacks for each type of event, which itself could be dynamically added or removed<ul><li>The responding process, a.k.a. invoking callbacks, should be asynchronous, which means it won&rsquo;t make GUI unresponsible. Note this is orthogonal to multi-threading since even a single thread is capable of parallel computing using techniques like coroutine.</li></ul></li><li>The ability to queue, delay, filter, and even compose events for more complicated behaviors</li></ul><p>More descriptions are welcome but the above abilities should be sufficient for a simple GUI framework.</p><p>Let&rsquo;s look into a famous non-ECS GUI framework, Qt. Qt uses a <a href=https://doc.qt.io/qt-6/signalsandslots.html>signal-slot mechanism</a> as its core event mechanism, which could be summarized as follows</p><ul><li>Any object should be inherited from <code>QObject</code> in order to use the signal-slot mechanism</li><li>A meta-compiler is needed to transform signal-slot related code into normal C++ code</li><li>Signal and slot are of a many-to-many relationship, which is connected by <code>connect</code> function. The execution of the slot function could happen in another thread depending on <a href=https://doc.qt.io/qt-6/qt.html#ConnectionType-enum>connection type</a></li><li>The exchanged data are defined by the arguments of signal and slot functions, which are type-checked by the meta-object system</li></ul><p>We can find out that except for advanced abilities like event composing, Qt&rsquo;s signal-slot mechanism loosely conforms to our expectations.</p><p>As to the ECS-based GUI framework, we could claim that those expectations should be satisfied more easily due to its flexibility, for example, we do not need a meta-compiler and singular inheritance. The data could be exchanged with a POD-style component across entities as well. We will leave it to implementation details or possibly another blog post in the future.</p><h3 id=summary-of-ecs-for-gui>Summary of ECS for GUI</h3><p>We have already discussed several use cases and concluded that ECS could be an even better solution than traditional OOP-based solutions for GUI programming.</p><p>And also please remember, VGG is utilizing designs as the base of a GUI. A common design would have up to 10-40k layers, even 250k layers.<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup> This places a huge performance challenge so we think ECS is just right here to rescue.</p><h2 id=conclusion>Conclusion</h2><p>In this article, we have discussed the essence of ECS architecture and GUI, and elaborated on several use cases of ECS in GUI programming. This is a very big and deep topic so it is impossible to cover everything in a single post, for instance, we haven&rsquo;t mentioned concrete implementation details of such an ECS architecture specialized for GUI programming.</p><p>There are many good ECS implementations around the internet, for example</p><ul><li><a href=https://github.com/skypjack/entt>EnTT</a> is implemented with a custom <a href=https://github.com/skypjack/entt/blob/master/src/entt/entity/sparse_set.hpp>sparse-set</a> data structure.</li><li><a href=https://github.com/SanderMertens/flecs>flecs</a> is implemented with a traditional <a href=https://ajmmertens.medium.com/building-an-ecs-2-archetypes-and-vectorization-fe21690805f9>archtype</a> method, where the addition and deletion of a component could be a theoretical performance bottleneck in common scenarios.</li><li><a href=https://github.com/amzeratul/halley>halley</a> engine, which is a game engine that successfully shipped a game called <a href=https://store.steampowered.com/app/607050/_/>Wargroove</a>, implements a <a href=https://github.com/amzeratul/halley/tree/develop/src/engine/entity/include/halley/entity>custom</a> ECS architecture</li></ul><p>VGG engine does not use a baked ECS framework like EnTT or flecs but chooses to implement one on our own, just like what halley has done. This is because we believe a tailored version better suits our use cases, particularly for programming GUI applications. Currently, VGG implements a simple ECS architecture that still lacks some features, but the inner iteration is happening. If you like the concept of <a href=../../posts/intro-vgg/>Design-as-Code</a> as well as the ECS architecture, you can keep an eye on our <a href=https://github.com/verygoodgraphics/vgg_runtime>open-sourced</a> version.</p><h2 id=contact-us>Contact us</h2><ul><li>Discord: <a href=https://discord.gg/g3HJuKP54D>https://discord.gg/g3HJuKP54D</a>
<img width=595 alt="Group-Eng 16 59 55" src=https://user-images.githubusercontent.com/111478642/196389211-64cfa786-dd66-4ae0-b7ec-b81e04ac274f.png></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>An entity can be as simple as an ID, or as complex as a universal container. It doesn&rsquo;t matter, as long as it has the semantics of putting components together, where real data live in.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>CRTP stands for Curiously-Recurring-Template-Pattern&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>SFINAE stands for Substitution-Failure-Is-Not-An-Error&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>As a matter of fact, most ECS-based systems do careful memory layout configuration to improve performance, like <a href=https://github.com/amzeratul/halley/blob/develop/src/engine/entity/include/halley/entity/entity.h#L154>this</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>POD stands for Plain-Old-Data-structure&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Usually systems account for such functions, but it doesn&rsquo;t matter if a component type has some small or inline functions.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>In Web programming, specifically React-based web programming, we have another <em>component</em> concept, which actually means reusable GUI widgets. To distinguish from our <em>component</em> concept in ECS, we just call this reusable GUI component <strong>widget</strong>.&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>From this <a href="https://news.ycombinator.com/item?id=33013123">discussion</a> on Hacker News&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Harry</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2023-08-11
<a href=https://github.com/verygoodgraphics/verygoodgraphics.github.io/commit/40ce6c6b56cb35160d461579dc8c64afc3deee9a title="update: renew the discord link">(40ce6c6)</a><br>update: renew the discord link</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=../../posts/cpp-wasm/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">Compile C++ into WebAssembly</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=../../posts/intro-vgg/><span class="next-text nav-default">Introducing VGG and Design-as-Code</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article><div class=bg-white><script src=https://utteranc.es/client.js repo=verygoodgraphics/vgg_blog_comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=https://github.com/verygoodgraphics rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" style viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://blog.verygoodgraphics.com/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span></span>
<span class=copyright-year>&copy;
2022 -
2023
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>VeryGoodGraphics</span></span>
<span id=busuanzi_container>UV/PV：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=../../lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=../../lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=../../js/main.1079d4d14ebe59c44f6c8274cb8621bef56aa92f66aa656aa05da7ffdfdc65ca.js integrity="sha256-EHnU0U6+WcRPbIJ0y4YhvvVqqS9mqmVqoF2n/9/cZco=" crossorigin=anonymous></script>
<script type=text/javascript src=../../js/load-photoswipe.js></script>
<script type=text/javascript src=../../lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=../../lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>